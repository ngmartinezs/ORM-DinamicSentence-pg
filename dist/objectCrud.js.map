{"version":3,"file":"objectCrud.js","sources":["../src/objectCrud.js"],"sourcesContent":["const ConnectionDB = require(\"./connectionDB\");\n\nconst obtenerMetaDataTabla = async (\n  pConnection,\n  pBaseDatos,\n  pEsquema,\n  pEntidad\n) => {\n  const META_SQL_TABLES = `select column_name nombre_columna,\n                                  column_default valor_por_defecto,\n                                  ordinal_position orden,\n                                  data_type tipo_dato,\n                                  is_nullable es_nulable,\n                                  character_maximum_length longitud_char,\n                                  numeric_precision longitud_numerica,\n                                  numeric_precision_radix numero_decimales\n                          from information_schema.columns \n                          where table_catalog= $1 \n                          and table_schema = $2 \n                          and table_name = $3;`;\n\n  const query = {\n    name: \"fetch-sql-meta-tables\",\n    text: META_SQL_TABLES,\n    values: [pBaseDatos, pEsquema, pEntidad],\n  };\n\n  try {\n    const lRetono = await pConnection.query(query);\n    return lRetorno;\n  } catch (error) {\n    throw error;\n  }\n};\n\nconst generarSQLConsulta = (pMetaDataArray, pEsquema, pEntidad, pFiltro) => {\n  var lSQL = `SELECT `;\n  var lContador = 0;\n  var lFiltro = ``;\n  var lArrayValues = [];\n  var lIndiceFiltro = 1;\n\n  if (pMetaData && pFiltro) {\n    /**\n     * Se genera SQL general de la consulta.\n     **/\n    pMetaDataArray.forEach((element) => {\n      if (contador === 0) lSQL = lSQL + element.nombre_columna;\n      else lSQL = lSQL + \",\" + element.nombre_columna;\n    });\n\n    lSQL = lSQL + \" FROM \" + pEsquema + \".\" + pEntidad;\n\n    /**\n     * Se genera los filtros.\n     **/\n    Object.getOwnPropertyNames(pFiltro).forEach((value, idx, array) => {\n      if (pFiltro[value]) {\n        if (lFiltro.length === 0) {\n          lFiltro = ` ${lFiltro} WHERE ${value} = $lIndiceFiltro `;\n          lArrayValues.push(pFiltro[value]);\n        } else {\n          lFiltro = ` ${filtro} AND ${value} = $lIndiceFiltro `;\n          lArrayValues.push(pFiltro[value]);\n        }\n\n        lIndiceFiltro++;\n      }\n    });\n\n    if (lFiltro.length !== 0 && lArrayValues.length > 0)\n      return {\n        name: \"fetch-sql-meta-tables\",\n        text: `${lSQL} ${lFiltro}`,\n        values: lArrayValues,\n      };\n  }\n};\n\nclass ObjectsCrud {\n  constructor() {\n    this.connectionDB = new ConnectionDB();\n  }\n\n  async consultar(pBaseDatos, pEsquema, pEntidad, pFiltro) {\n    try {\n      const lConnection = this.connectionDB.getConnection();\n      const lMetaDataTabla = await obtenerMetaDataTabla(\n        lConnection,\n        pBaseDatos,\n        pEsquema,\n        pEntidad\n      );\n\n      const lSQLConsulta = generarSQLConsulta(\n        lMetaDataTabla,\n        pEsquema,\n        pEntidad,\n        pFiltro\n      );\n\n      if (lSQLConsulta) {\n        const lResultado = await lConnection.query(lSQLConsulta);\n\n        if (lResultado)\n          return {\n            CODIGO_RETORNO: 0,\n            MENSAJE_RETORNO: \"OK\",\n            DATA: lResultado.rows,\n          };\n        else\n          return {\n            CODIGO_RETORNO: 1,\n            MENSAJE_RETORNO: \"No se encontro data\",\n            DATA: [],\n          };\n      } else\n        return {\n          CODIGO_RETORNO: 2,\n          MENSAJE_RETORNO: \"No se establecieron filtros de consulta correctos\",\n          DATA: [],\n        };\n    } catch (error) {\n      throw error;\n    } finally {\n      await this.connectionDB.closeConnection();\n    }\n  }\n\n  insertar(pBaseDatos, pEsquema, pEntidad, pDatos) {\n    return {\n      CODIGO_RETORNO: 0,\n      MENSAJE_RETORNO: \"OK\",\n      DATA: {},\n    };\n  }\n\n  update(pBaseDatos, pEsquema, pEntidad, pDatos) {\n    return {\n      CODIGO_RETORNO: 0,\n      MENSAJE_RETORNO: \"OK\",\n      DATA: {},\n    };\n  }\n\n  delete(pBaseDatos, pEsquema, pEntidad, pDatos) {\n    return {\n      CODIGO_RETORNO: 0,\n      MENSAJE_RETORNO: \"OK\",\n      DATA: {},\n    };\n  }\n}\n\nmodule.exports = ObjectsCrud;\n"],"names":["body","recover","result","e","then","ConnectionDB","require","module","exports","this","connectionDB","consultar","pBaseDatos","pEsquema","pEntidad","pFiltro","finalizer","lConnection","_this2","getConnection","pConnection","query","name","text","values","lRetono","lRetorno","error","obtenerMetaDataTabla","lMetaDataTabla","lSQLConsulta","pMetaDataArray","lSQL","lFiltro","lArrayValues","pMetaData","forEach","element","contador","nombre_columna","Object","getOwnPropertyNames","value","idx","array","length","push","filtro","generarSQLConsulta","lResultado","CODIGO_RETORNO","MENSAJE_RETORNO","DATA","rows","bind","closeConnection","insertar","pDatos","update"],"mappings":"AAkjBO,WAAgBA,EAAMC,GAC5B,IACC,IAAIC,EAASF,IACZ,MAAMG,GACP,OAAOF,EAAQE,GAEhB,OAAID,GAAUA,EAAOE,KACbF,EAAOE,UAAK,EAAQH,GAErBC,EA3jBR,IAAMG,EAAeC,QAAQ,kBA0J7BC,OAAOC,mBA1EL,aACEC,KAAKC,aAAe,IAAIL,6BAGpBM,mBAAUC,EAAYC,EAAUC,EAAUC,aAExBN,4BAyenB,SAA0BT,EAAMgB,GACtC,IACC,IAAId,eA3eA,IAAMe,EAAcC,EAAKR,aAAaS,gBADpC,gCAlFNC,EACAR,EACAC,EACAC,OAEA,IAaMO,EAAQ,CACZC,KAAM,wBACNC,8sBACAC,OAAQ,CAACZ,EAAYC,EAAUC,IAjB9B,2DAqBqBM,EAAYC,MAAMA,kBAAlCI,GACN,OAAOC,qBACAC,GACP,MAAMA,KA7BgB,mCAqFSC,CAC3BX,EACAL,EACAC,EACAC,kBAJIe,GAON,IAAMC,EA3De,SAACC,EAAgBlB,EAAUC,EAAUC,GAC9D,IAAIiB,YAEAC,KACAC,EAAe,GAGnB,GAAIC,WAAapB,IAIfgB,EAAeK,QAAQ,SAACC,GACL,IAAbC,SAAgBN,GAAcK,EAAQE,eACrCP,EAAOA,EAAO,IAAMK,EAAQE,iBAGnCP,EAAOA,EAAO,SAAWnB,EAAW,IAAMC,EAK1C0B,OAAOC,oBAAoB1B,GAASqB,QAAQ,SAACM,EAAOC,EAAKC,GACnD7B,EAAQ2B,KACa,IAAnBT,EAAQY,QACVZ,MAAcA,YAAiBS,uBAC/BR,EAAaY,KAAK/B,EAAQ2B,MAE1BT,MAAcc,eAAcL,uBAC5BR,EAAaY,KAAK/B,EAAQ2B,QAOT,IAAnBT,EAAQY,QAAgBX,EAAaW,OAAS,GAChD,MAAO,CACLvB,KAAM,wBACNC,KAASS,MAAQC,EACjBT,OAAQU,GAoBWc,CACnBnB,EACAhB,EACAC,EACAC,GAbA,OAgBEe,kBACuBb,EAAYI,MAAMS,kBAArCmB,GAEN,OAAIA,EACK,CACLC,eAAgB,EAChBC,gBAAiB,KACjBC,KAAMH,EAAWI,MAGZ,CACLH,eAAgB,EAChBC,gBAAiB,sBACjBC,KAAM,MAGH,CACLF,eAAgB,EAChBC,gBAAiB,oDACjBC,KAAM,gBAEHzB,GACP,MAAMA,IAucT,MAAOxB,GACR,OAAOa,GAAU,EAAMb,GAExB,OAAID,GAAUA,EAAOE,KACbF,EAAOE,KAAKY,EAAUsC,KAAK,MAAM,GAAQtC,EAAUsC,KAAK,MAAM,IAE/DtC,GAAU,EAAOd,2CA3cbgB,EAAKR,aAAa6C,oGAI5BC,SAAA,SAAS5C,EAAYC,EAAUC,EAAU2C,GACvC,MAAO,CACLP,eAAgB,EAChBC,gBAAiB,KACjBC,KAAM,OAIVM,OAAA,SAAO9C,EAAYC,EAAUC,EAAU2C,GACrC,MAAO,CACLP,eAAgB,EAChBC,gBAAiB,KACjBC,KAAM,cAIV,SAAOxC,EAAYC,EAAUC,EAAU2C,GACrC,MAAO,CACLP,eAAgB,EAChBC,gBAAiB,KACjBC,KAAM"}